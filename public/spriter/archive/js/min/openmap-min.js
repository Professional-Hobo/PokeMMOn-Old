function openMap(e,r){var o=[];jQuery.get(e,function(e){function o(){var e=0,t=mapObj.split("\n");for(var r in t){var n=t[r].split(""),o=n.length;o>=e&&(e=o)}return e*grid}function a(){var e=mapObj.split("\n");return e.length*grid}function s(e){var t=0,r=0;r=a(),t=o(),e.canvas.width=t,e.canvas.height=r}function l(e,t,n){var o=new Image,t=t*grid,n=n*grid;o.onload=function(){m.drawImage(o,e[0]*grid,e[1]*grid,grid,grid,t,n,grid,grid)},o.src=r}function d(e){function t(e,t){function r(){for(var r in u.tiles){var o=u.tiles[r]["char"];if(o==t[n]){var i=[0,0];l(i,n,e)}}}for(var n in t)r()}var r=e.split(""),n=e.split("\n");for(var o in n){var i=n[o].split("");t(o,i)}}function g(){function e(){var e=o()/grid,t=a()/grid;for(n=0;n<t;n++){var r=[];for(i=0;i<e;i++)r.push("(0,0)");d.push(r)}}function t(e,t){var n=Math.floor(e.offsetX/grid),o=Math.floor(e.offsetY/grid);(n!=r||o!=s)&&(l(t,n,o),g=d,g[o][n]="("+t[0]+","+t[1]+")",console.log("Brush",t),r=n,s=o)}var r=0,s=0,d=[],g=[];e();var f=0;map.addEventListener("mousedown",function(e){f=1,t(e,brush)}),map.addEventListener("mouseup",function(e){f=0}),map.addEventListener("mousemove",function(e){f&&t(e,brush)},!1)}function f(e){var r=new Image;r.onload=function(){t.drawImage(r,0,0)},r.src=e}function c(){var e=0,r=0,n=0;p.addEventListener("mousedown",function(r){e=1;var n=Math.floor(r.offsetX/grid),o=Math.floor(r.offsetY/grid);t.clearRect(0,0,p.width,p.height),f("img/map_tile.png");var i=document.getElementById("selector");i.style.width=grid+"px",i.style.height=grid+"px",i.style.left=n*grid+"px",i.style.top=o*grid+"px",brush=[n,o],console.log(brush),g(brush)}),p.addEventListener("mouseup",function(t){e=0;var r=document.getElementById("selector"),n=[],o=parseInt(r.style.width)/grid,i=parseInt(r.style.height)/grid,a=parseInt(r.style.left)/grid,s=parseInt(r.style.top)/grid;console.log("w: "+i),console.log("h: "+o),console.log("x: "+a),console.log("y: "+s),n=[a,s],console.log("selected",n),brush=n,console.log(JSON.stringify(n))},!1),p.addEventListener("mousemove",function(t){if(e){var o=Math.floor(t.offsetX/grid),i=Math.floor(t.offsetY/grid);if(o!=r||i!=n){console.log("new");var a=document.getElementById("selector"),s=parseInt(a.style.left);selectorTopCoords=parseInt(a.style.top),a.style.width=o*grid+grid-s+"px",a.style.height=i*grid+grid-selectorTopCoords+"px",r=o,n=i}}},!1)}mapObj=e;var u={map_name:"default",tiles:[{name:"land","char":"-",x:0,y:0},{name:"grass","char":"#",x:0,y:1}]};s(m),d(mapObj),g();var p=document.getElementById("tileset");t=p.getContext("2d"),f(mapSource),c()})}openMap("map_blank.txt",mapSource);